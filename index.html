<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Codx - 2D → 3D Yapay Zeka</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    /* Genel sayfa stilleri */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #000;
      color: #fff;
      position: relative;
    }
    /* Arkada canlı kar animasyonu (örnek) */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: url('https://cdn.pixabay.com/animation/2023/03/02/10/01/10-01-34-959_512.gif') no-repeat center center fixed;
      background-size: cover;
      opacity: 0.25;
      z-index: -1;
      pointer-events: none;
      filter: brightness(0.8);
    }

    header {
      background-color: rgba(13, 71, 161, 0.85);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 2rem;
      letter-spacing: 1px;
      font-weight: bold;
      backdrop-filter: blur(4px);
      user-select: none;
    }

    nav {
      background-color: rgba(30, 144, 255, 0.85);
      padding: 10px;
      text-align: center;
      backdrop-filter: blur(3px);
      user-select: none;
    }

    nav a {
      color: white;
      margin: 0 18px;
      text-decoration: none;
      font-weight: 700;
      font-size: 1.1rem;
      transition: color 0.3s ease;
    }

    nav a:hover {
      color: #ffcc00;
      text-decoration: underline;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    section {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      text-align: center;
      backdrop-filter: blur(5px);
      color: #eee;
    }

    h1, h2 {
      color: #ffda79;
      text-shadow: 1px 1px 3px #222;
    }

    form {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.15);
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
      backdrop-filter: blur(5px);
    }

    input[type="file"] {
      margin-bottom: 20px;
      cursor: pointer;
      border-radius: 10px;
      padding: 10px;
      font-weight: 700;
      background: linear-gradient(135deg, #6dd5fa, #2980b9);
      color: white;
      border: none;
      box-shadow: 0 4px 10px rgba(41, 128, 185, 0.6);
      transition: background 0.4s ease;
    }
    input[type="file"]:hover {
      background: linear-gradient(135deg, #2980b9, #6dd5fa);
    }

    button {
      background: linear-gradient(135deg, #ff7e5f, #feb47b);
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1.1rem;
      box-shadow: 0 6px 20px rgba(255,126,95,0.6);
      transition: background 0.4s ease;
    }
    button:hover {
      background: linear-gradient(135deg, #feb47b, #ff7e5f);
    }

    #result {
      margin-top: 40px;
      text-align: center;
    }

    model-viewer {
      width: 400px;
      height: 400px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.7);
      transition: transform 0.4s ease;
      background: #222;
    }
    model-viewer:hover {
      transform: scale(1.04);
    }

    footer {
      background-color: rgba(13, 71, 161, 0.85);
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 60px;
      backdrop-filter: blur(4px);
      user-select: none;
    }

    /* -------------- AI Destek Chat KUTUSU -------------- */
    #ai-chat-box {
      border-radius: 15px;
      border: 2px solid transparent;
      background: linear-gradient(145deg, #f9f9f9, #e5e5e5);
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      display: none;
      flex-direction: column;
      z-index: 9999;
      overflow: hidden;
      user-select: text;
      color: #333;
      width: 350px;
      max-height: 500px;
      bottom: 100px;
      right: 30px;
      position: fixed;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #ai-chat-header {
      background: linear-gradient(90deg, #ff6a00, #ee0979, #00f260, #0575e6, #8e2de2);
      background-size: 300% 300%;
      animation: rainbowBG 8s ease infinite;
      color: white;
      padding: 14px 18px;
      font-weight: 900;
      font-size: 1.25rem;
      text-align: center;
      user-select: none;
      letter-spacing: 1.2px;
      border-radius: 10px 10px 0 0;
    }
    @keyframes rainbowBG {
      0% {background-position:0% 50%;}
      50% {background-position:100% 50%;}
      100% {background-position:0% 50%;}
    }

    #ai-chat-messages {
      flex-grow: 1;
      padding: 15px;
      overflow-y: auto;
      font-size: 1rem;
      line-height: 1.5;
      background: #fff;
      border-radius: 0 0 10px 10px;
      color: #222;
      box-shadow: inset 0 0 10px #ddd;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .msg {
      padding: 10px 16px;
      font-weight: 600;
      max-width: 80%;
      word-wrap: break-word;
      border-radius: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      line-height: 1.4;
    }

    .msg.user {
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      color: #4a1f1f;
      align-self: flex-end;
      box-shadow: 0 2px 8px #ff9a9e88;
      border-radius: 15px 15px 0 15px;
    }

    .msg.bot {
      background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
      color: #103f5f;
      align-self: flex-start;
      box-shadow: 0 2px 8px #a1c4fd88;
      border-radius: 15px 15px 15px 0;
    }

    #ai-chat-input-wrap {
      background: #f0f0f0;
      display: flex;
      gap: 10px;
      padding: 12px 15px;
      border-top: 1px solid #ddd;
      border-radius: 0 0 10px 10px;
    }

    #ai-chat-input {
      flex-grow: 1;
      border-radius: 20px;
      border: 1px solid #ccc;
      padding: 10px 20px;
      font-size: 1rem;
      outline: none;
      color: #333;
      font-weight: 600;
      box-shadow: inset 0 1px 3px #ddd;
      transition: border-color 0.3s;
    }
    #ai-chat-input:focus {
      border-color: #a37de6;
      box-shadow: inset 0 1px 5px #b199f8;
    }
    #ai-chat-input::placeholder {
      color: #999;
      font-weight: 400;
    }

    #ai-chat-send {
      background: #a37de6;
      border: none;
      color: white;
      padding: 0 25px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      box-shadow: 0 4px 12px #9e7de7cc;
      transition: background-color 0.3s;
    }
    #ai-chat-send:hover:not(:disabled) {
      background: #7e58cc;
    }
    #ai-chat-send:disabled {
      background: #bfb7d8;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Destek butonu sağ alt */
    #support-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, #fc5c7d, #6a82fb);
      border: none;
      border-radius: 50px;
      color: white;
      font-weight: 800;
      font-size: 1.2rem;
      padding: 14px 24px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(252,92,125,0.6);
      transition: box-shadow 0.3s ease;
      z-index: 10000;
      user-select: none;
    }
    #support-btn:hover {
      box-shadow: 0 12px 32px rgba(106,130,251,0.8);
    }
  </style>
</head>
<body>
  <header>Codx - 2D → 3D Yapay Zeka</header>
  <nav>
    <a href="#upload">2D Resim Seç</a>
    <a href="#ai-chat-box" id="nav-chat-link">AI Destek</a>
  </nav>

  <main>
    <section id="upload">
      <h2>2D Resim Yükle</h2>
      <form id="upload-form">
        <input type="file" id="file-input" accept="image/*" required />
        <button type="submit">3D'ye Dönüştür</button>
      </form>
    </section>

    <section id="result">
      <h2>3D Model Önizleme</h2>
      <model-viewer
        id="model-viewer"
        alt="3D model"
        src=""
        shadow-intensity="1"
        camera-controls
        ar
        ar-modes="webxr scene-viewer quick-look"
        style="display:none;"
      ></model-viewer>
    </section>
  </main>

  <!-- AI Destek Chat -->
  <div id="ai-chat-box" aria-live="polite" aria-label="Yapay Zeka Destek Chat">
    <div id="ai-chat-header">Codx AI Destek</div>
    <div id="ai-chat-messages" role="log" aria-live="polite" aria-relevant="additions"></div>
    <div id="ai-chat-input-wrap">
      <input
        type="text"
        id="ai-chat-input"
        placeholder="Bir şeyler yaz..."
        aria-label="Mesaj yaz"
        autocomplete="off"
      />
      <button id="ai-chat-send" disabled>Gönder</button>
    </div>
  </div>

  <!-- Destek butonu -->
  <button id="support-btn" aria-haspopup="true" aria-controls="ai-chat-box" aria-expanded="false">Destek</button>

  <script>
    // Model yükleme örneği - boş fonksiyon (sen backend ile bağlarsın)
    document.getElementById('upload-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fileInput = document.getElementById('file-input');
      if (!fileInput.files.length) return alert('Lütfen bir resim seçin.');

      // Burada API çağrısı yapılacak, sonucu model-viewer'a ver
      // demo olarak sadece model-viewer'ı gösteriyoruz
      const modelViewer = document.getElementById('model-viewer');
      modelViewer.src = 'https://modelviewer.dev/shared-assets/models/Astronaut.glb'; // Demo model
      modelViewer.style.display = 'block';
    });

    // AI Chat işlevselliği
    const supportBtn = document.getElementById('support-btn');
    const aiChatBox = document.getElementById('ai-chat-box');
    const aiChatMessages = document.getElementById('ai-chat-messages');
    const aiChatInput = document.getElementById('ai-chat-input');
    const aiChatSend = document.getElementById('ai-chat-send');

    supportBtn.addEventListener('click', () => {
      if (aiChatBox.style.display === 'flex') {
        aiChatBox.style.display = 'none';
        supportBtn.setAttribute('aria-expanded', 'false');
      } else {
        aiChatBox.style.display = 'flex';
        supportBtn.setAttribute('aria-expanded', 'true');
        aiChatInput.focus();
      }
    });

    aiChatInput.addEventListener('input', () => {
      aiChatSend.disabled = aiChatInput.value.trim().length === 0;
    });

    aiChatSend.addEventListener('click', async () => {
      const message = aiChatInput.value.trim();
      if (!message) return;

      addMessage(message, 'user');
      aiChatInput.value = '';
      aiChatSend.disabled = true;
      aiChatInput.focus();

      // OpenAI API çağrısı yap
      addMessage("Yapay Zeka yanıtını bekleyin...", 'bot', true);
      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer sk-d8wDEp4XCLj4qGWC2pXtIxs0wpXZpGnwsvXCMih6BFfrnbEl5O8zOAiWYaG'
          },
          body: JSON.stringify({
            model: 'gpt-4o-mini',
            messages: [{role: 'user', content: message}],
            max_tokens: 350,
            temperature: 0.7,
          }),
        });
        const data = await response.json();
        const botMsg = data.choices?.[0]?.message?.content || "Üzgünüm, yanıt alınamadı.";
        updateLastBotMessage(botMsg);
      } catch (err) {
        updateLastBotMessage("API çağrısında hata oluştu.");
        console.error(err);
      }
    });

    function addMessage(text, sender, isTemp = false) {
      if (isTemp) {
        const tempMsg = document.createElement('div');
        tempMsg.className = 'msg bot';
        tempMsg.textContent = text;
        aiChatMessages.appendChild(tempMsg);
        aiChatMessages.scrollTop = aiChatMessages.scrollHeight;
        return tempMsg;
      }
      const msgDiv = document.createElement('div');
      msgDiv.className = 'msg ' + sender;
      msgDiv.textContent = text;
      aiChatMessages.appendChild(msgDiv);
      aiChatMessages.scrollTop = aiChatMessages.scrollHeight;
      return msgDiv;
    }

    let lastBotMessageElem = null;
    function updateLastBotMessage(newText) {
      if (!lastBotMessageElem) {
        lastBotMessageElem = addMessage(newText, 'bot');
      } else {
        lastBotMessageElem.textContent = newText;
      }
      aiChatMessages.scrollTop = aiChatMessages.scrollHeight;
    }
  </script>
</body>
</html>
